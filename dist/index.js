!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";const t=["#00f0f0","#0000f5","#f0a000","#f0f000","#00f000","#a000f0","#f00000"],e=[[[1,1,1,1]],[[2,0,0],[2,2,2]],[[0,0,3],[3,3,3]],[[4,4],[4,4]],[[0,5,5],[5,5,0]],[[0,6,0],[6,6,6]],[[7,7,0],[0,7,7]]];class i{constructor(t,e,i=null){this.board=t,this.shape=e,this.position=i,this.downTick=0,this.position||(this.position={x:Math.floor(this.board.getWidth()/2-this.shape[0].length/2),y:-this.shape.length})}static randomShape(t){const s=e[Math.floor(Math.random()*e.length)];return new i(t,s)}rotate(){const t=this.shape,e=t.length,i=t[0].length,s=[];for(let h=0;h<i;h++){const i=[];for(let s=e-1;s>=0;s--)i.push(t[s][h]);s.push(i)}const h=this.position.y+Math.floor(this.shape.length/2)-Math.floor(s.length/2),o=this.position.x+Math.floor(this.shape[0].length/2)-Math.floor(s[0].length/2),a=o+s[0].length<=this.board.getWidth()&&o>=0,n=h+s.length<=this.board.getHeight();if(a&&n){const t=structuredClone(this.board.getBoard());for(let e=0;e<this.shape.length;++e)for(let i=0;i<this.shape[e].length;++i)this.position.y+e>=0&&(t[e+this.position.y][i+this.position.x]=0);for(let e=0;e<s.length;++e)for(let i=0;i<s[e].length;++i)if(h+e>=0&&0!==t[e+h][i+o])return;this.position.y=h,this.position.x=o,this.shape=s}this.board.update(!1)}canGoLeft(){var t;const e=this.shape,i=this.position,s=this.board.getBoard();for(let h=0;h<e.length;++h)for(let o=0;o<e[h].length;++o){if(i.y+h>=0&&(0===e[h][o-1]||void 0===e[h][o-1])&&0!==(null===(t=s[h+i.y])||void 0===t?void 0:t[o+i.x-1])&&0!==i.x&&0!==e[h][o])return!1}return!0}canGoRiht(){var t;const e=this.shape,i=this.position,s=this.board.getBoard();for(let h=0;h<e.length;++h)for(let o=0;o<e[h].length;++o){if(i.y+h>=0&&(0===e[h][o+1]||void 0===e[h][o+1])&&0!==(null===(t=s[h+i.y])||void 0===t?void 0:t[o+i.x+1])&&i.x!==this.board.getWidth()-e[0].length&&0!==e[h][o])return!1}return!0}canGoDown(){var t,e,i;if(this.haveReachedBottom())return++this.downTick,this.downTick<=1;const s=this.shape,h=this.position,o=this.board.getBoard();for(let a=0;a<s.length;++a)for(let n=0;n<s[a].length;++n){if(h.y+a+1>=0&&(0===(null===(t=s[a+1])||void 0===t?void 0:t[n])||void 0===(null===(e=s[a+1])||void 0===e?void 0:e[n]))&&0!==(null===(i=o[a+h.y+1])||void 0===i?void 0:i[n+h.x])&&0!==s[a][n])return++this.downTick,this.downTick<=1}return this.downTick=0,!0}goDown(){this.position.y!==this.board.getHeight()-this.shape.length&&0===this.downTick&&++this.position.y,this.board.update(!1)}goRight(){this.canGoRiht()&&(this.position.x!==this.board.getWidth()-this.shape[0].length&&++this.position.x,this.board.update(!1))}goLeft(){this.canGoLeft()&&(0!==this.position.x&&this.position.x--,this.board.update(!1))}haveReachedBottom(){return this.position.y===this.board.getHeight()-this.shape.length}getShape(){return this.shape}getPosition(){return this.position}copy(){return new i(this.board,this.shape,structuredClone(this.position))}}class s{constructor(t=12,e=24){this.width=t,this.height=e,this.board=[],this.score=0,this.actualShape=i.randomShape(this),this.nextShape=i.randomShape(this),this.buildBoard()}buildBoard(){for(let t=0;t<this.width*this.height;++t)t%this.width==0&&this.board.push([]),this.board[this.board.length-1].push(0)}removeLastShapeDraw(){if(!this.backShape)return;const t=this.backShape.getShape(),e=this.backShape.getPosition();for(let i=0;i<t.length;++i)for(let s=0;s<t[i].length;++s)e.y+i<0||0!==t[i][s]&&(this.board[i+e.y][s+e.x]=0)}displayShape(){const t=this.actualShape.getShape(),e=this.actualShape.getPosition();for(let i=0;i<t.length;++i)for(let s=0;s<t[i].length;++s)e.y+i<0||0!==t[i][s]&&(this.board[i+e.y][s+e.x]=t[i][s])}haveLoose(){return this.board[0].some((t=>0!==t))&&!this.actualShape.canGoDown()}removeCompletedLines(){for(let t=0;t<this.board.length;++t){this.board[t].every((t=>0!==t))&&(this.score+=10,this.board.splice(t,1),this.board.unshift(Array(this.width).fill(0)))}}update(t=!0){this.removeLastShapeDraw(),this.actualShape.canGoDown()||(this.displayShape(),window.requestAnimationFrame((()=>this.removeCompletedLines())),this.actualShape=this.nextShape,this.nextShape=i.randomShape(this)),this.backShape=this.actualShape.copy(),t&&this.actualShape.goDown(),this.displayShape()}getScore(){return this.score}getBoard(){return this.board}getWidth(){return this.width}getHeight(){return this.height}getActualShape(){return this.actualShape}getNextShape(){return this.nextShape}reset(){this.board=[],this.actualShape=i.randomShape(this),this.nextShape=i.randomShape(this),this.backShape=null,this.score=0,this.buildBoard()}}class h{constructor(t,e){this.gameHandler=t,this.keys=e,this.initListener()}initListener(){const t=this.gameHandler.getBoard();document.addEventListener("keydown",(e=>{if(!this.gameHandler.isRunning())return;const i=e.key,s=Object.entries(this.keys).find((t=>t[1].toLocaleLowerCase()===i.toLocaleLowerCase()));if(s){const e=t.getActualShape();switch(s[0]){case"RIGHT":e.goRight();break;case"LEFT":e.goLeft();break;case"DOWN":e.goDown();break;case"ROTATE":e.rotate()}this.gameHandler.drawGame(),t.haveLoose()&&this.gameHandler.loose()}}))}}var o;!function(t){t.LOOSE="You loose",t.NOT_PLAYING="Not playing",t.PLAYING="Playing"}(o||(o={}));const a=400,n={RIGHT:"ArrowRight",DOWN:"ArrowDown",LEFT:"ArrowLeft",ROTATE:"ArrowUp"};const r=document.querySelector("canvas"),l=document.querySelector("#play"),c=document.querySelector("#pause"),d=document.querySelector("#reset"),p=new class{constructor(t){this.canvas=t,this.board=new s,this.gameStatus=o.NOT_PLAYING,this.ctx=this.canvas.getContext("2d"),this.canvasWidth=t.width,this.canvasHeight=t.height,this.keyHandler=new h(this,n),this.drawGame()}drawPolygon(t,e){this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;++e)this.ctx.lineTo(t[e].x,t[e].y);this.ctx.closePath(),this.ctx.fill()}drawRect(t,e,i,s=0,h=0){const o=this.canvasWidth/2/this.board.getWidth(),a=this.canvasHeight/this.board.getHeight(),n=t*o+s,r=e*a+h;this.ctx.fillStyle=i,this.ctx.fillRect(n,r,o,a);const l=[{x:n,y:r},{x:n+o,y:r},{x:n+o-2,y:r+a/4},{x:n+2,y:r+a/4}],c=[{x:n,y:r+a},{x:n+o,y:r+a},{x:n+o-2,y:r+a-a/4},{x:n+2,y:r+a-a/4}],d=[{x:n,y:r},{x:n+o/4,y:r+2},{x:n+o/4,y:r+a-2},{x:n,y:r+a}],p=[{x:n+o,y:r},{x:n+o-o/4,y:r+2},{x:n+o-o/4,y:r+a-2},{x:n+o,y:r+a}];this.drawPolygon(l,"#ffffff80"),this.drawPolygon(c,"#00000080"),this.drawPolygon(d,"#00000050"),this.drawPolygon(p,"#00000050")}drawGame(){const e="#212129";this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvasWidth/2,this.canvasHeight);const i=this.board.getBoard();for(let e=0;e<i.length;++e)for(let s=0;s<i[e].length;++s){if(0===i[e][s])continue;const h=t[i[e][s]-1];this.drawRect(s,e,h)}const s=this.canvasWidth/2+10;this.ctx.fillStyle=e,this.ctx.font="20px sans-serif",this.ctx.fillText("Score: "+this.board.getScore(),s,30),this.ctx.fillText("Game status:",s,60),this.ctx.fillText("- "+this.gameStatus,s,80),this.ctx.fillText("Next Shape:",s,110);const h=this.board.getNextShape().getShape();for(let e=0;e<h.length;++e)for(let i=0;i<h[e].length;++i){if(0===h[e][i])continue;const o=t[h[e][i]-1];this.drawRect(i,e,o,s,120)}}loose(){this.gameStatus=o.LOOSE,this.drawGame(),this.reset(!1)}start(){this.clock||(this.gameStatus=o.PLAYING,this.clock=setInterval((()=>{this.board.update(),this.drawGame(),this.board.haveLoose()&&this.loose()}),a))}stop(){clearInterval(this.clock),this.gameStatus=o.NOT_PLAYING,this.clock=null}reset(t=!0){this.stop(),this.board.reset(),t&&this.drawGame()}isRunning(){return!!this.clock}getBoard(){return this.board}}(r);l.addEventListener("click",(()=>p.start())),c.addEventListener("click",(()=>p.stop())),d.addEventListener("click",(()=>p.reset()));const g=new class{constructor(t){this.gameHandler=t,this.fps=60}main(){}start(){this.clock||(this.clock=setTimeout((()=>this.main()),1e3/this.fps))}stop(){this.clock&&clearTimeout(this.clock)}setFps(t){this.fps=t}}(p),u=document.querySelector("#fps"),f=document.querySelector("#start-ai"),y=document.querySelector("#stop-ai");u.addEventListener("change",(()=>g.setFps(Number(u.value)))),f.addEventListener("click",(()=>g.start())),y.addEventListener("click",(()=>g.stop()))}));
//# sourceMappingURL=index.js.map
